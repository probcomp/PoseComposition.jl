<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Operations on Poses · PoseComposition.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">PoseComposition.jl</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">PoseComposition.jl</a></li><li class="is-active"><a class="tocitem" href>Operations on Poses</a><ul class="internal"><li><a class="tocitem" href="#First-group-structure:-change-of-coordinate-frame"><span>First group structure: change of coordinate frame</span></a></li><li><a class="tocitem" href="#Second-group-structure:-direct-product-of-position-and-orientation"><span>Second group structure: direct product of position and orientation</span></a></li></ul></li><li><a class="tocitem" href="../further_api_reference/">Further API Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Operations on Poses</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Operations on Poses</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/probcomp/PoseComposition.jl/blob/master/docs/src/operations.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Operations-on-Poses"><a class="docs-heading-anchor" href="#Operations-on-Poses">Operations on Poses</a><a id="Operations-on-Poses-1"></a><a class="docs-heading-anchor-permalink" href="#Operations-on-Poses" title="Permalink"></a></h1><hr/><p>A <a href="../further_api_reference/#PoseComposition.Pose"><code>Pose</code></a> can represent either a relative pose (relative to some parent coordinate frame which must be supplied by context) or an absolute pose.  An absolute pose is, by definition, a pose relative to the world coordinate frame.</p><h2 id="First-group-structure:-change-of-coordinate-frame"><a class="docs-heading-anchor" href="#First-group-structure:-change-of-coordinate-frame">First group structure: change of coordinate frame</a><a id="First-group-structure:-change-of-coordinate-frame-1"></a><a class="docs-heading-anchor-permalink" href="#First-group-structure:-change-of-coordinate-frame" title="Permalink"></a></h2><p>A central operation on poses is change of coordinate frame:</p><pre><code class="language-none">(absolute pose of frame2) = (absolute pose of frame1) * (relative pose of frame2 relative to frame1)</code></pre><p>This operation gives the set of poses a group structure – call it the &quot;pose group&quot; <span>$G$</span>.  This <span>$G$</span> is the <a href="https://en.wikipedia.org/wiki/Opposite_group">opposite group</a> of the group of <a href="https://en.wikipedia.org/wiki/Special_Euclidean_group">rigid transformations</a></p><p><span>$SE_3 = \mathbb{R}^3 \ltimes SO_3(\mathbb{R})$</span></p><p>(technical note<sup class="footnote-reference"><a id="citeref-1" href="#footnote-1">[1]</a></sup>), meaning that relative poses are &quot;applied&quot; on the right, rather than written as function applications on the left.</p><p>The group operation is implemented via <code>Pose</code>-specific methods of the standard Julia functions in <code>Base</code>:</p><ul><li>Multiplication: <code>pose1 * pose2</code></li><li>Inversion: <code>inv(pose)</code>, such that <code>pose * inv(pose) == inv(pose) * pose == IDENTITY_POSE</code></li><li>Right-division: <code>pose1 / pose2 := pose1 * inv(pose2)</code></li><li>Left-division: <code>pose1 \ pose2 := inv(pose1) * pose2</code></li></ul><h4 id="Convention:-First-translate,-then-rotate"><a class="docs-heading-anchor" href="#Convention:-First-translate,-then-rotate">Convention: First translate, then rotate</a><a id="Convention:-First-translate,-then-rotate-1"></a><a class="docs-heading-anchor-permalink" href="#Convention:-First-translate,-then-rotate" title="Permalink"></a></h4><p>Note that we define the group operation on the pose group by doing the translation first, then the rotation.  So the coordinate frame <code>pose1 * pose2</code> has an origin whose coordinates in the frame of <code>pose1</code> are <code>pose2.pos</code> (the translational component of <code>pose2</code>).</p><p>Note also that the orientation <code>orn := pose.orientation</code> represents the linear operator</p><pre><code class="language-none">v ↦ Rotations.RotMatrix{3}(orn) * v   =:   orn * v</code></pre><p>In other words, we are using the convention that matrix-vector multiplication has the vector on the right.  The x, y and z axes of an object with pose <code>pose</code> are <code>pose.orientation * [1, 0, 0]</code>, <code>pose.orientation * [0, 1, 0]</code> and <code>pose.orientation * [0, 0, 1]</code> respectively.</p><h5 id="Example:-Which-order-do-I-multiply-things-in?"><a class="docs-heading-anchor" href="#Example:-Which-order-do-I-multiply-things-in?">Example: Which order do I multiply things in?</a><a id="Example:-Which-order-do-I-multiply-things-in?-1"></a><a class="docs-heading-anchor-permalink" href="#Example:-Which-order-do-I-multiply-things-in?" title="Permalink"></a></h5><p>Say we want to start with pose <code>p1</code> and translate its origin by <code>p2</code> and matrix-multiply its orientation by <code>p2</code>.  Would that new pose be written as <code>p1 * p2</code> or <code>p2 * p1</code>?</p><p>Answer: <code>p1 * p2</code>.</p><h4 id="Mathematical-details:-contravariance,-coordinate-frames,-and-rigid-motions"><a class="docs-heading-anchor" href="#Mathematical-details:-contravariance,-coordinate-frames,-and-rigid-motions">Mathematical details: contravariance, coordinate frames, and rigid motions</a><a id="Mathematical-details:-contravariance,-coordinate-frames,-and-rigid-motions-1"></a><a class="docs-heading-anchor-permalink" href="#Mathematical-details:-contravariance,-coordinate-frames,-and-rigid-motions" title="Permalink"></a></h4><p>There are two ways to think about poses:</p><ol><li>A pose is a coordinate frame, described with respect to some other base coordinate frame.  The <code>pos</code> says where the frame&#39;s origin is, and the <code>orientation</code> says what directions its right-handed orthonormal axes point in.</li><li>A pose is a rigid motion.  The translational component is <code>pos</code> and the orientation component is <code>orientation</code>.</li></ol><p>When we talk about the <a href="https://en.wikipedia.org/wiki/Group_action_(mathematics)">group action</a> of <span>$G$</span> on itself by multiplication, we want to say that a rigid transformation (way 2 above) acts on a coordinate frame (way 1 above), by moving the origin a translational offset of <code>pos</code> and matrix-multiplying its rotation by <code>orientation</code>.  The thing to note is that, even though function application is usually written on the left, this group action <em>right</em>-associative, so it must be represented by right-multiplication, not left-multiplication (or else the associative law breaks).</p><h3 id="Points-and-point-clouds"><a class="docs-heading-anchor" href="#Points-and-point-clouds">Points and point clouds</a><a id="Points-and-point-clouds-1"></a><a class="docs-heading-anchor-permalink" href="#Points-and-point-clouds" title="Permalink"></a></h3><p>Above we explained how a pose can act on another pose.  It is also possible for a pose to act on a point in <span>$\mathbb{R}^3$</span>.  To see how, note that for poses <code>a</code> and <code>b</code>, the position of the product, <code>(a * b).pos</code>, does not depend on <code>b.orientation</code>.  Therefore it is valid to define, for any <code>a::Pose</code> and any <span>$\texttt{bpos} ∈ \mathbb{R}^3$</span>,</p><pre><code class="language-none">a * bpos := (a * Pose(bpos, orn)).pos</code></pre><p>where <code>orn</code> is any orientation (and its value does not affect the result).</p><p>In words, <code>a * bpos</code> is the coordinates in the world frame of the vector whose coordinates in the frame represented by <code>a</code> are <code>bpos</code>.</p><p>From this it&#39;s straightforward to see that the usual associativity law holds:</p><pre><code class="language-none">a * (b * cpos) = (a * b) * cpos</code></pre><p>Therefore pose–point multiplication is indeed a group action of <span>$G$</span> on <span>$\mathbb{R}^3$</span>.</p><p>This package implements both <code>Pose * point</code> and a vectorized version, <code>Pose * pointcloud</code>, where <code>pointcloud</code> is a <span>$3 × N$</span> matrix in which each column represents a point:</p><pre><code class="language-julia-repl">julia&gt; Pose([1, 2, 3], RotZYX(0.4, 0.5, 0.6)) * @SVector([7, 8, 9])

3-element StaticArrays.SArray{Tuple{3},Float64,1,3} with indices SOneTo(3):
 11.340627918648092
  8.023198113213361
 10.126885626769848

julia&gt; Pose([1, 2, 3], RotZYX(0.4, 0.5, 0.6)) * [7  10  13  16;
                                                 8  11  14  17;
                                                 9  12  15  18]

3×4 Array{Float64,2}:
 11.3406  15.3024  19.2641  23.2258
  8.0232  10.5473  13.0714  15.5955
 10.1269  12.3481  14.5693  16.7904</code></pre><h2 id="Second-group-structure:-direct-product-of-position-and-orientation"><a class="docs-heading-anchor" href="#Second-group-structure:-direct-product-of-position-and-orientation">Second group structure: direct product of position and orientation</a><a id="Second-group-structure:-direct-product-of-position-and-orientation-1"></a><a class="docs-heading-anchor-permalink" href="#Second-group-structure:-direct-product-of-position-and-orientation" title="Permalink"></a></h2><p>The composition operation described above and denoted by <code>*</code> is useful when manipulating chains of relative poses, which commonly occur in scene graphs. We now define a second group structure on the set of <code>Pose</code>s: the direct product <span>$\mathbb{R}^3 × SO_3(\mathbb{R})$</span>.  We denote the group operation in this second structure by <code>⊗</code>, and it means &quot;add the positions and (separately) compose the orientations.&quot;  This operation models inertial motion, where an object has separate translational and rotational velocities:</p><p class="math-container">\[\begin{aligned}
\mathbf{x} &amp;= \mathbf{x}_0 + Δ\mathbf{x} \\
\boldsymbol{ω} &amp;= \boldsymbol{ω}_0 \cdot Δ\boldsymbol{ω}
\end{aligned}\]</p><p>or simply</p><pre><code class="language-julia">pose1 = pose0 ⊗ Δpose</code></pre><p>This second group operation is implemented via the following infix operators:</p><ul><li>Multiplication: <code>pose1 ⊗ pose2</code> (<span>$\LaTeX$</span>: <code>\otimes</code>)</li><li>Right-division: <code>pose1 ⊘ pose2</code> (<span>$\LaTeX$</span>: <code>\oslash</code>)</li><li>Left-division: <code>pose1 ⦸ pose2</code> (<span>$\LaTeX$</span>: <code>\obslash</code>)</li></ul><p>The direct product structure is useful for performing computations that treat translational and rotational components separately, such as computing the pose of a moving object by integrating its velocity.  The translational and rotational components of the velocity are integrated separately – in differential geometry terms, motion is governed by the <a href="https://en.wikipedia.org/wiki/Exponential_map_(Lie_theory)">exponential map</a> on the Lie algebra of <span>$\mathbb{R}^3 × SO_3(\mathbb{R})$</span>, not the Lie algebra of <span>$SE_3$</span>.</p><h3 id="Inter/Extrapolation,-a.k.a.-stepping-time-forward-a-fractional-number-of-times"><a class="docs-heading-anchor" href="#Inter/Extrapolation,-a.k.a.-stepping-time-forward-a-fractional-number-of-times">Inter/Extrapolation, a.k.a. stepping time forward a fractional number of times</a><a id="Inter/Extrapolation,-a.k.a.-stepping-time-forward-a-fractional-number-of-times-1"></a><a class="docs-heading-anchor-permalink" href="#Inter/Extrapolation,-a.k.a.-stepping-time-forward-a-fractional-number-of-times" title="Permalink"></a></h3><p>One nice property of the direct product (and its physical application of integrating a velocity) is that there is a straightforward analogue of the physics 101 equation</p><p class="math-container">\[\mathbf{x} = \mathbf{x}_0 + t \mathbf{v}\]</p><p>where <span>$\mathbf{x}_0$</span> is the initial displacement of an object, <span>$t$</span> is time, and <span>$\mathbf{v}$</span> is the object&#39;s velocity, which is assumed to stay constant. That analogue is</p><pre><code class="language-none">pose = pose0 ⊗ interp(v, t)</code></pre><p>where <code>pose</code>, <code>pose0</code> and <code>v</code> are <code>Pose</code>s, and <code>t</code> is a <code>Real</code>.  The function <a href="../further_api_reference/#PoseComposition.interp-Tuple{PoseComposition.Pose,PoseComposition.Pose,Real}"><code>interp</code></a> defines how to interpolate between doing nothing and translating by <code>v.pos</code> (namely, scalar multiplication) and how to interpolate between doing nothing and applying the rotation <code>v.orientation</code> (namely, <a href="https://en.wikipedia.org/wiki/Slerp#Quaternion_Slerp">SLERP</a>).</p><p>There is also a variant of <code>interp</code> that takes two pose arguments and interpolates between them:</p><pre><code class="language-none">pose = interp(pose0, pose1, t)</code></pre><p>which is equivalent to</p><pre><code class="language-none">pose = pose0 ⊗ interp(pose0 ⦸ pose1, t)</code></pre><p>In particular, we have <code>pose = pose0</code> when <code>t = 0</code> and <code>pose = pose1</code> when <code>t = 1</code>.</p><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-1"><a class="tag is-link" href="#citeref-1">1</a>In code, elements of <span>$G$</span> whose orientation is represented as a <code>Rotations.UnitQuaternion</code> (as opposed to some other subtype of <code>Rotations.Rotation{3}</code>) remember their sign (<code>q</code> and <code>-q</code> are considered equal by <code>Base.:==</code>, but their fields are not equal).</li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« PoseComposition.jl</a><a class="docs-footer-nextpage" href="../further_api_reference/">Further API Reference »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Tuesday 2 February 2021 04:45">Tuesday 2 February 2021</span>. Using Julia version 1.4.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
